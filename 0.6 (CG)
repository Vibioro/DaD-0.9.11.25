from IPython.display import display, clear_output
import time
import random
countMoney = 0
TF = False
ObjXY = {}
countMove = 0
exit = False

#–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã (Settings game):
sightPole = 5         #–®–∏—Ä–∏–Ω–∞ –ø–æ–ª—è (Width map)
linePole = 5          #–î–ª–∏–Ω–Ω–∞ –ø–æ–ª—è (Length map)
countMoneyPlay = 5    #–ö–æ–ª-–≤–æ –º–æ–Ω–µ—Ç (Count moneys)
countPrept = 3        #–ö–æ–ª-–≤–æ –∫–æ—Ä–æ–±–æ–∫ (count box)
Lange = 2             #–Ø–∑—ã–∫: 1 - –†—É—Å—Å–∫–∏–π, 2 - –ê–Ω–≥–ª–∏–π—Å–∫–∏–π (Lange: 1 - Russian, 2 - English)

class Dungeon_and_Dragons:
  def __init__(self, S, L):
    self.S = S
    self.L = L

  def CreateCoordPlayer(self):
    randomX = random.randint(0, self.L - 1)
    randomY = random.randint(0, self.S - 1)
    ObjXY["Player"] = [randomX, randomY]

  def CreateCoordFinish(self):
    ObjXY["Finish"] = ObjXY["Player"]
    while ObjXY["Finish"] == ObjXY["Player"]:
      randomX = random.randint(0, self.L - 1)
      randomY = random.randint(0, self.S - 1)
      ObjXY[f"Finish"] = [randomX, randomY]

  def CreateCoordPrept(self, count):
    for x in range(count):
      ObjXY[f"Prept{x}"] = ObjXY["Player"]
      brak = True
      while brak == True:
        brak = False
        randomX = random.randint(0, self.L - 1)
        randomY = random.randint(0, self.S - 1)
        ObjXY[f"Prept{x}"] = [randomX, randomY]
        for y in ObjXY:
          if ObjXY.get(y) == ObjXY[f"Prept{x}"] and y != f"Prept{x}":
            brak = True
        if brak == False:
          ObjXY[f"Prept{x}"] = [randomX, randomY]

  def CreateCoordMoneys(self, count):
    for x in range(count):
      ObjXY[f"Money{x}"] = ObjXY[f"Player"]
      brak = True
      while brak == True:
        brak = False
        randomX = random.randint(0, self.L - 1)
        randomY = random.randint(0, self.S - 1)
        ObjXY[f"Money{x}"] = [randomX, randomY]
        for y in ObjXY:
          if ObjXY.get(y) == ObjXY[f"Money{x}"] and y != f"Money{x}":
            brak = True
        if brak == False:
          ObjXY[f"Money{x}"] = [randomX, randomY]


  def printLine(self, line, answer, CMP, CP, TF, countMoney):
    for sight in range(self.S):
      typeObj = None
      for x in ObjXY:
        #print(ObjXY.get(x), line, sight)
        if ObjXY.get(x) == [line, sight]:
          if typeObj != None and x[0] == "M":
            countMoney += 1
            del ObjXY[x]
            break

          if typeObj == None:
            typeObj = x
      if typeObj == None:
        answer += "‚¨ú "
      elif typeObj == "Player":
        answer += "üôÇ "
      elif typeObj[0] == "F":
        answer += "üèÅ "
      elif typeObj[0] == "M":
        answer += "üü° "
      elif typeObj[0] == "P":
        answer += "üü´ "
    return answer, countMoney

  def BackPlayer(PPX, PPY):
    ObjXY[f"Player"] = [prPosPX, prPosPY]


class SpeakLange:
  def __init__(self, Lange):
    self.Lange = Lange
  def InGame(self, countMoney, countMoneyPlay, movePlr):
    if self.Lange == 1:
      print(f"–°–æ–±—Ä–∞–Ω–æ {countMoney} –º–æ–Ω–µ—Ç–æ–∫ –∏–∑ {countMoneyPlay}") #({countMoney/countMoneyPlay*100}%)
      movePlr = input("–ú—ã –¥–æ–ª–∂–Ω—ã –Ω–∞—á–∞—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ! (W - –í–≤–µ—Ä—Ö, S - –í–Ω–∏–∑, A - –í–ª–µ–≤–æ, D - –í–ø—Ä–∞–≤–æ): ")
    else:
      print(f"Collected {countMoney} Money from {countMoneyPlay}") #({countMoney/countMoneyPlay*100}%)
      movePlr = input("We start moving! (W - Up, S - Down, A - Left, D - Right): ")
    return movePlr
  def EndGame(self):
    spId = 0
    speech = [f"–¢—ã –≤—ã–∏–≥—Ä–∞–ª, c–¥–µ–ª–∞–≤ {countMove} —à–∞–≥–æ–≤!",
              f"–ü–æ–∑–¥—Ä–∞–≤–ª—è—é —Ç–µ–±—è —Å –ø–æ–±–µ–¥–æ–π! –¢—ã —Å–¥–µ–ª–∞–ª {countMove} —à–∞–≥–æ–≤",
              f"–ü–æ–∑–¥—Ä–∞–≤–ª—è—é –æ—Ç –≤—Å–µ–≥–æ —Å—á–∞—Å—Ç—å—è —Ç–µ–±—è —Å –ø–æ–±–µ–¥–æ–π!! –¢—ã —Å—É–º–µ–ª –ø—Ä–æ–π—Ç–∏ —Å–ª–æ–∂–Ω—ã–π –ø—É—Ç—å –∏ –≤—Å–µ –∂–µ –ø—Ä–æ—à–µ–ª –∏–≥—Ä—É –∑–∞ {countMove} —à–∞–≥–æ–≤! –†–æ–¥–∏–Ω–∞ –≥–æ—Ä–¥–∏—Ç—Å—è —Ç–æ–±–æ–π!",
              f"You won in {countMove} moves!", 
              f"Congrats on the win! You did it in {countMove} moves.", 
              f"Congratulations on your victory!! You managed the tough journey and beat the game in {countMove} moves! Your homeland is proud of you!"]

    if self.Lange == 2:
      spId += 3
    randomEnd = random.randint(1, 100)
    if randomEnd <= 45:
      print(speech[spId])
    elif randomEnd <= 78:
      print(speech[spId + 1])
    elif randomEnd <= 99:
      print(speech[spId + 2])
    elif randomEnd <= 100:
      print(f"#@%#%@#%%#%@%#%%@ {countMove} @#$@#$#@$#$@@")


speak = SpeakLange(Lange)
DaD = Dungeon_and_Dragons(sightPole, linePole)
DaD.CreateCoordPlayer()
DaD.CreateCoordFinish()
DaD.CreateCoordMoneys(countMoneyPlay)
DaD.CreateCoordPrept(countPrept)
while True:
  clear_output(wait=False)
  time.sleep(0.1)
  countMove += 1
  #print(ObjXY)
  for x in range(linePole):
    answer = ""
    answer, countMoney = DaD.printLine(x, answer, countMoneyPlay, countPrept, TF, countMoney)
    print(answer)
  movePlr = 0
  movePlr = speak.InGame(countMoney, countMoneyPlay, movePlr)

  prPosPX = ObjXY[f"Player"][0]
  prPosPY = ObjXY[f"Player"][1]
  if movePlr == "W" or movePlr == "w":
    ObjXY[f"Player"][0] -= 1
  elif movePlr == "S" or movePlr == "s":
    ObjXY[f"Player"][0] += 1
  elif movePlr == "A" or movePlr == "a":
    ObjXY[f"Player"][1] -= 1
  elif movePlr == "D" or movePlr == "d":
    ObjXY[f"Player"][1] += 1
  for x in ObjXY:
      if ObjXY[f"Player"] == ObjXY.get(x):
        if x == 'Finish':
          if countMoney != countMoneyPlay:
            Dungeon_and_Dragons.BackPlayer(prPosPX, prPosPY)
          else:
            exit = True
            break
        elif x[0] == "P" and x[1] == "r":
          Dungeon_and_Dragons.BackPlayer(prPosPX, prPosPY)
          break
  if exit == True:
    break #–ü–æ–±–µ–¥–∞ (Win)

speak.EndGame()
