from IPython.display import display, clear_output
import time
import random
countMoney = 0
ObjXY = {}
countMove = 0
result = False
createMap = True

#–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã (Settings game):
sightPole = 6         #–®–∏—Ä–∏–Ω–∞ –∫–∞—Ä—Ç—ã (Width map)
linePole = 5          #–î–ª–∏–Ω–Ω–∞ –∫–∞—Ä—Ç—ã (Length map)
countMoneyPlay = 5    #–ö–æ–ª-–≤–æ –º–æ–Ω–µ—Ç (Count moneys)
countPrept = 3        #–ö–æ–ª-–≤–æ –∫–æ—Ä–æ–±–æ–∫ (count box)
Lange = 1             #–Ø–∑—ã–∫: 1 - –†—É—Å—Å–∫–∏–π, 2 - –ê–Ω–≥–ª–∏–π—Å–∫–∏–π (Lange: 1 - Russian, 2 - English)

#–°–∫–∏–Ω—ã (Skins):
skinPlr = "üôÇ" + " "      #–ò–≥—Ä–æ–∫ (Player)
skinFinish = "üèÅ" + " "   #–§–∏–Ω–∏—à (Finish)
skinMoney = "üü°" + " "    #–ú–æ–Ω–µ—Ç–∞ (Money)
skinBox = "üü´" + " "      #–ö–æ—Ä–æ–±–∫–∞ (Box)
skinVoidCell = "‚¨ú" + " " #–ü—É—Å—Ç–∞—è –∫–ª–µ—Ç–∫–∞ (Void cell)


class Dungeon_and_Dragons:
  def __init__(self, S, L, skinPlr, skinFinish, skinMoney, skinBox, skinVoidCell):
    self.S = S
    self.L = L
    self.Plr = skinPlr
    self.Fin = skinFinish
    self.Mon = skinMoney
    self.Box = skinBox
    self.VC = skinVoidCell

  def CreateCoordPlayer(self):
    randomX = random.randint(0, self.L - 1)
    randomY = random.randint(0, self.S - 1)
    ObjXY["Player"] = [randomX, randomY]

  def CreateCoordFinish(self):
    ObjXY["Finish"] = ObjXY["Player"]
    while ObjXY["Finish"] == ObjXY["Player"]:
      randomX = random.randint(0, self.L - 1)
      randomY = random.randint(0, self.S - 1)
      ObjXY[f"Finish"] = [randomX, randomY]

  def CreateCoordPrept(self, count):
    for x in range(count):
      ObjXY[f"Prept{x}"] = ObjXY["Player"]
      brak = True
      while brak == True:
        brak = False
        randomX = random.randint(0, self.L - 1)
        randomY = random.randint(0, self.S - 1)
        ObjXY[f"Prept{x}"] = [randomX, randomY]
        for y in ObjXY:
          if ObjXY.get(y) == ObjXY[f"Prept{x}"] and y != f"Prept{x}":
            brak = True
        if brak == False:
          ObjXY[f"Prept{x}"] = [randomX, randomY]

  def CreateCoordMoneys(self, count):
    for x in range(count):
      ObjXY[f"Money{x}"] = ObjXY[f"Player"]
      brak = True
      while brak == True:
        brak = False
        randomX = random.randint(0, self.L - 1)
        randomY = random.randint(0, self.S - 1)
        ObjXY[f"Money{x}"] = [randomX, randomY]
        for y in ObjXY:
          if ObjXY.get(y) == ObjXY[f"Money{x}"] and y != f"Money{x}":
            brak = True
        if brak == False:
          ObjXY[f"Money{x}"] = [randomX, randomY]


  def printLine(self, line, answer, CMP, CP, countMoney):
    for sight in range(self.S):
      typeObj = None
      for x in ObjXY:
        if ObjXY.get(x) == [line, sight]:
          if typeObj != None and x[0] == "M":
            countMoney += 1
            del ObjXY[x]
            break

          if typeObj == None:
            typeObj = x
      if typeObj == None:
        answer += self.VC
      elif typeObj == "Player":
        answer += self.Plr
      elif typeObj[0] == "F":
        answer += self.Fin
      elif typeObj[0] == "M":
        answer += self.Mon
      elif typeObj[0] == "P":
        answer += self.Box
    return answer, countMoney

  def BackPlayer(PPX, PPY):
    ObjXY[f"Player"] = [prPosPX, prPosPY]


class SpeakLange:
  def __init__(self, Lange):
    self.Lange = Lange
  def InGame(self, countMoney, countMoneyPlay, movePlr):
    if self.Lange == 1:
      print(f"–°–æ–±—Ä–∞–Ω–æ {countMoney} –º–æ–Ω–µ—Ç–æ–∫ –∏–∑ {countMoneyPlay}") #({countMoney/countMoneyPlay*100}%)
      movePlr = input("–î–µ–ª–∞–π –¥–≤–∏–∂–µ–Ω–∏–µ! (W;w - –í–≤–µ—Ä—Ö, S;s - –í–Ω–∏–∑, A;a - –í–ª–µ–≤–æ, D;d - –í–ø—Ä–∞–≤–æ) –∏–ª–∏ –≤–≤–µ–¥–∏ –∫–æ–º–∞–Ω–¥—É (/Restart;/restart;/R;/r - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫, /Leave;/leave;/L;/l - –í—ã—Ö–æ–¥): ")
    else:
      print(f"Collected {countMoney} Money from {countMoneyPlay}") #({countMoney/countMoneyPlay*100}%)
      movePlr = input("Make move! (W;w - Up, S;s - Down, A;a - Left, D;d - Right) or enter command (/Restart;/restart;/R;/r - /Restart, /Leave;/leave;/L;/l - Leave): ")
    return movePlr
  def EndGame(self):
    spId = 0
    speech = [f"–¢—ã –≤—ã–∏–≥—Ä–∞–ª, c–¥–µ–ª–∞–≤ {countMove} —à–∞–≥–æ–≤!",
              f"–ü–æ–∑–¥—Ä–∞–≤–ª—è—é —Ç–µ–±—è —Å –ø–æ–±–µ–¥–æ–π! –¢—ã —Å–¥–µ–ª–∞–ª {countMove} —à–∞–≥–æ–≤",
              f"–ü–æ–∑–¥—Ä–∞–≤–ª—è—é –æ—Ç –≤—Å–µ–≥–æ —Å—á–∞—Å—Ç—å—è —Ç–µ–±—è —Å –ø–æ–±–µ–¥–æ–π!! –¢—ã —Å—É–º–µ–ª –ø—Ä–æ–π—Ç–∏ —Å–ª–æ–∂–Ω—ã–π –ø—É—Ç—å –∏ –≤—Å–µ –∂–µ –ø—Ä–æ—à–µ–ª –∏–≥—Ä—É –∑–∞ {countMove} —à–∞–≥–æ–≤! –†–æ–¥–∏–Ω–∞ –≥–æ—Ä–¥–∏—Ç—Å—è —Ç–æ–±–æ–π!",
              f"You won in {countMove} moves!", 
              f"Congrats on the win! You did it in {countMove} moves.", 
              f"Congratulations on your victory!! You managed the tough journey and beat the game in {countMove} moves! Your homeland is proud of you!"]

    if self.Lange == 2:
      spId += 3
    randomEnd = random.randint(1, 100)
    if randomEnd <= 45:
      print(speech[spId])
    elif randomEnd <= 78:
      print(speech[spId + 1])
    elif randomEnd <= 99:
      print(speech[spId + 2])
    elif randomEnd <= 100:
      print(f"#@%#%@#%%#%@%#%%@ {countMove} @#$@#$#@$#$@@")


speak = SpeakLange(Lange)
DaD = Dungeon_and_Dragons(sightPole, linePole, skinPlr, skinFinish, skinMoney, skinBox, skinVoidCell)
while True:
  if createMap == True:
    ObjXY.clear()
    createMap = False
    DaD.CreateCoordPlayer()
    DaD.CreateCoordFinish()
    DaD.CreateCoordMoneys(countMoneyPlay)
    DaD.CreateCoordPrept(countPrept)

  clear_output(wait=False)
  time.sleep(0.1)
  print(ObjXY[f"Player"])
  countMove += 1
  for x in range(linePole):
    answer = ""
    answer, countMoney = DaD.printLine(x, answer, countMoneyPlay, countPrept, countMoney)
    print(answer)
  movePlr = 0
  movePlr = speak.InGame(countMoney, countMoneyPlay, movePlr)

  prPosPX = ObjXY[f"Player"][0]
  prPosPY = ObjXY[f"Player"][1]
  if movePlr == "W" or movePlr == "w":
    ObjXY[f"Player"][0] -= 1
  elif movePlr == "S" or movePlr == "s":
    ObjXY[f"Player"][0] += 1
  elif movePlr == "A" or movePlr == "a":
    ObjXY[f"Player"][1] -= 1
  elif movePlr == "D" or movePlr == "d":
    ObjXY[f"Player"][1] += 1
  #–ö–æ–º–∞–Ω–¥—ã (Command):
  elif movePlr == "/Leave" or movePlr == "/leave" or movePlr == "/L" or movePlr == "/l":
    break #–í—ã—Ö–æ–¥ (Leave)
  elif movePlr == "/Restart" or movePlr == "/restart" or movePlr == "/R" or movePlr == "/r":
    createMap = True

  if 0 > ObjXY[f"Player"][0] or ObjXY[f"Player"][0] > linePole-1  or 0 > ObjXY[f"Player"][1] or ObjXY[f"Player"][1] > sightPole-1:
    Dungeon_and_Dragons.BackPlayer(prPosPX, prPosPY)
  for x in ObjXY:
      if ObjXY[f"Player"] == ObjXY.get(x):
        if x == 'Finish':
          if countMoney != countMoneyPlay:
            Dungeon_and_Dragons.BackPlayer(prPosPX, prPosPY)
          else:
            result = True
            break
        elif x[0] == "P" and x[1] == "r":
          Dungeon_and_Dragons.BackPlayer(prPosPX, prPosPY)
          break
  if result == True:
    break #–ü–æ–±–µ–¥–∞ (Win)

if result == True:
  speak.EndGame()
